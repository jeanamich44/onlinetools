<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>MRZ Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
<div class="container">
  <h1>MRZ Generator</h1>
  <p class="subtitle">ICAO 9303</p>

  <form id="mrzForm">
    <input name="mode" placeholder="mode (manuel | aleatoire)">

    <input name="nom" placeholder="Nom">
    <input name="prenom" placeholder="Prénom">
    <input name="dep" placeholder="Département (2 chiffres)">
    <input name="canton" placeholder="Canton (1 caractère)">
    <input name="bureau" placeholder="Bureau (3 chiffres)">
    <input name="date_delivrance" placeholder="Date délivrance (AAMM)">
    <input name="random_code" placeholder="Code aléatoire (4 chiffres)">
    <input name="naissance" placeholder="Date naissance (AAMMJJ)">
    <input name="sexe" placeholder="Sexe (M/F)">

    <button type="submit">Générer MRZ</button>
  </form>

  <pre id="result" style="margin-top:14px; white-space:pre;"></pre>

  <a class="back" href="./tools-liste.html">← Retour</a>
</div>

<script>
const API_URL = "https://onlinetools-production.up.railway.app/generate-mrz";

document.getElementById("mrzForm").onsubmit = async (e) => {
  e.preventDefault();
  const result = document.getElementById("result");
  result.textContent = "Génération en cours...";

  const data = Object.fromEntries(new FormData(e.target));

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });

    if (!res.ok) {
      const err = await res.json();
      throw new Error(err.detail || "Erreur API");
    }

    const out = await res.json();
    result.textContent = out.mrz.join("\n\n");

  } catch (err) {
    result.textContent = err.message;
  }
};
</script>

</body>
</html>
