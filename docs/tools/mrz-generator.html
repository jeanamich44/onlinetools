<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>MRZ Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>
  <div class="container">
    <h1>MRZ Generator</h1>
    <p class="subtitle">ICAO 9303</p>

    <form id="mrzForm">
      <div style="display: flex; gap: 10px; margin-bottom: 10px;">
        <button type="button" id="btnManual" style="margin-top:0; flex:1;">Manuel</button>
        <button type="button" id="btnRandom"
          style="margin-top:0; flex:1; background:#161a22; border:1px solid #2a2f3a;">Aléatoire</button>
      </div>
      <input type="hidden" name="mode" id="modeInput" value="manuel">

      <input name="nom" placeholder="Nom">
      <input name="prenom" placeholder="Prénom">
      <input name="dep" placeholder="Département (2 chiffres)">
      <input name="canton" placeholder="Canton (1 caractère)">
      <input name="bureau" placeholder="Bureau (3 chiffres)">
      <input name="date_delivrance" placeholder="Date délivrance (AAMM)">
      <input name="random_code" placeholder="Code aléatoire (4 chiffres)">
      <input name="naissance" placeholder="Date naissance (AAMMJJ)">
      <input name="sexe" placeholder="Sexe (M/F)">

      <button type="submit">Générer MRZ</button>
    </form>

    <pre id="result" style="margin-top:14px; white-space:pre;"></pre>

    <a class="back" href="./tools-liste.html">← Retour</a>
  </div>

  <script>
    const API_URL = "https://liste-tools-production.up.railway.app/generate-mrz";

    const btnManual = document.getElementById('btnManual');
    const btnRandom = document.getElementById('btnRandom');
    const modeInput = document.getElementById('modeInput');

    function setMode(mode) {
      modeInput.value = mode;
      if (mode === 'manuel') {
        btnManual.style.background = '#2563eb';
        btnManual.style.border = 'none';
        btnRandom.style.background = '#161a22';
        btnRandom.style.border = '1px solid #2a2f3a';
      } else {
        btnRandom.style.background = '#2563eb';
        btnRandom.style.border = 'none';
        btnManual.style.background = '#161a22';
        btnManual.style.border = '1px solid #2a2f3a';
      }
    }

    btnManual.onclick = () => setMode('manuel');
    btnRandom.onclick = () => setMode('aleatoire');

    document.getElementById("mrzForm").onsubmit = async (e) => {
      e.preventDefault();
      const result = document.getElementById("result");
      result.textContent = "Génération en cours...";

      const data = Object.fromEntries(new FormData(e.target));

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (!res.ok) {
          const err = await res.json();
          throw new Error(err.detail || "Erreur API");
        }

        const out = await res.json();
        result.textContent = out.mrz.join("\n\n");

      } catch (err) {
        result.textContent = err.message;
      }
    };
  </script>

</body>

</html>