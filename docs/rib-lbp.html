<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>RIB LBP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
</head>
<body>

<div class="container">
    <h1>RIB LBP</h1>
    <p class="subtitle">Génération PDF</p>

    <form id="ribForm">
        <input name="sexe" placeholder="Sexe (m/f)">
        <input name="banque" placeholder="Banque">
        <input name="guichet" placeholder="Guichet">
        <input name="compte" placeholder="Compte">
        <input name="cle" placeholder="Clé">
        <input name="iban" placeholder="IBAN">
        <input name="bic" placeholder="BIC">
        <input name="nom_prenom" placeholder="Nom Prénom">
        <input name="adresse" placeholder="Adresse">
        <input name="cp_ville" placeholder="CP Ville">
        <input name="domiciliation" placeholder="Domiciliation">
        <button type="submit">Générer PDF</button>
    </form>

    <div id="message"></div>
    <a class="back" href="index.html">Retour</a>
</div>

<script>
const API_URL = "https://onlinetools-production.up.railway.app/generate-pdf";
const form = document.getElementById("ribForm");
const message = document.getElementById("message");

function showMessage(text, type="error") {
    message.textContent = text;
    message.className = type;
    message.style.opacity = "1";
    setTimeout(() => message.style.opacity = "0", 5000);
}

form.onsubmit = async (e) => {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(form).entries());

    try {
        const res = await fetch(API_URL, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(data)
        });

        if (!res.ok) {
            const err = await res.json();
            throw new Error(err.detail || "Erreur serveur");
        }

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "rib_lbp.pdf";
        a.click();
        URL.revokeObjectURL(url);

        showMessage("PDF généré", "success");
    } catch (e) {
        showMessage(e.message);
    }
};
</script>

</body>
</html>
